<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Louis OLIVE">

<title>Classification trees and ensemble methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Classification trees and ensemble methods_files/libs/clipboard/clipboard.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/quarto.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/popper.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/anchor.min.js"></script>
<link href="Classification trees and ensemble methods_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Classification trees and ensemble methods_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<link href="Classification trees and ensemble methods_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Classification trees and ensemble methods_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Classification trees and ensemble methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Louis OLIVE </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>In the first lessons, we have mainly used a Logistic Regression model to deal with a binary classification / scoring problem.</p>
<p>Logistic regression models may prove inadequate<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> when dealing with scenarios characterized by non-linearity in the input-output relationship or when there are interactions among the input variables. This is when decision trees come to the forefront.</p>
<p>Decision trees recursively partition the data by applying specific cutoff values to the features. This process creates various subsets of the data set, with each data point belonging to one of these subsets. The final subsets are known as Terminal or Leaf nodes, while the intermediate ones are referred to as Internal, Split or Decision nodes.</p>
<p><img src="images/decison_tree.png" class="img-fluid"></p>
<p>In order to make predictions within each leaf node, the average outcome of the training data contained in that node is utilized.</p>
<p>Numerous algorithms exist for growing decision trees, each differing in aspects such as the potential structure of the tree, the criteria for identifying splits, when to cease the splitting process…</p>
<section id="cart" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> CART</h1>
<p>We describe bellow a popular method for tree-based regression and classification called CART. We follow the terminology of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> (chapter 9.2).</p>
<p>Classification And Regression Tree (CART) (<span class="citation" data-cites="Breiman83">Breiman et al. (<a href="#ref-Breiman83" role="doc-biblioref">1983</a>)</span>), is a recursive method:</p>
<ul>
<li><p>At the root of the tree we find the entire sample.</p></li>
<li><p>Each node of the tree divides the sample into 2 branches, according to a feature variable (discrete, continuous or ordinal variable (threshold) or a nominal variable (set of categories).</p></li>
<li><p>A terminal node is called a leaf. Usually the tree is represented upside down with its root at the top</p></li>
</ul>
<p>The tree is built by the following process: first the single variable is found which best splits the data into two groups (‘best’ will be defined later). The data is separated, and then this process is applied separately to each sub-group, and so on recursively until a stopping rule occurs (either no improvement can be made or the subgroups reach a minimum size).</p>
<p>To illustrate the process we start with a Classification Tree on <span class="math inline">\(x_1,x_2\in\mathbb R^2\)</span> for the <strong>Mixture</strong> data set:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated mixture (ORANGE/BLUE) from ESLII/ISLR</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> change path</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">'../data/mixture.example.RData'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>x1_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">1</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>x2_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">2</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mixture_means <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x1_means, x2_means) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(rowid <span class="sc">&lt;=</span> <span class="dv">10</span>, <span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mixture_means) <span class="sc">+</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span> Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> mixture.example<span class="sc">$</span>y</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">1</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data_mixture_example <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Y, x1, x2) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(Y))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw dataset</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>new_mixture <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../1_Scoring_and_Logistic_Regression/new_mixture.rds"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_mixture[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>,<span class="dv">5001</span><span class="sc">:</span><span class="dv">5251</span>),]) <span class="sc">+</span> <span class="co"># we plot only the first 250 of each class</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> mixture_means, <span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span>Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot) </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mixture_example_CART <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Starting from the top of the tree and going down the CART algorithm splits at each node according to a binary decision.</p>
<p>It ends up splitting the space into six regions, and then model the output by the mode/majority (classification) or proportion (scoring/probability) of <span class="math inline">\(Y\)</span> in each region. The result is the following:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cutoff_1 <span class="ot">&lt;-</span> <span class="fl">0.14</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>cutoff_2 <span class="ot">&lt;-</span> <span class="fl">2.2</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cutoff_3 <span class="ot">&lt;-</span> <span class="fl">3.1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>cutoff_4 <span class="ot">&lt;-</span> <span class="fl">0.98</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>cutoff_5 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>x1_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>x1_max <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>x2_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>x2_max <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>r1x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> x1_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>r1y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_min) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>r2x <span class="ot">&lt;-</span> (cutoff_2 <span class="sc">+</span> cutoff_3) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>r2y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>r3x <span class="ot">&lt;-</span> (cutoff_3 <span class="sc">+</span> x1_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>r3y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>r4x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> cutoff_2) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>r4y <span class="ot">&lt;-</span> (cutoff_4 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>r5x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> cutoff_5) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>r5y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> cutoff_4) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>r6x <span class="ot">&lt;-</span> (cutoff_2 <span class="sc">+</span> cutoff_5) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>r6y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> cutoff_4) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw dataset</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r1x, y=r1y, label = "R[1]", parse=TRUE) +</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=x1_min-0.25, y=cutoff_1, label = "s[1]", parse=TRUE) +</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=cutoff_2, y=x2_max+0.2, label = "s[2]", parse=TRUE) +</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r2x, y=r2y, label = "R[2]", parse=TRUE) +</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=cutoff_3, y=x2_max+0.2, label = "s[3]", parse=TRUE) +</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r3x, y=r3y, label = "R[3]", parse=TRUE) +</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=x1_min-0.25, y=cutoff_4, label = "s[4]", parse=TRUE) +</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r4x, y=r4y, label = "R[4]", parse=TRUE) +</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_5, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_5, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r5x, y=r5y, label = "R[5]", parse=TRUE) +</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=cutoff_5, y=x2_max+0.2, label = "s[5]", parse=TRUE) +</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotate("text", x=r6x, y=r6y, label = "R[6]", parse=TRUE) +</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At each step, the input variable and split-point is chosen to achieve a best fit given some criterion. Then one or both of these regions are split into two more regions, and this process is continued, until some stopping rule is applied.</p>
<p>For example, with the Mixture data, CART first splits at <span class="math inline">\(x_2=s_1=0.14\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then the region <span class="math inline">\(x_2 &lt; s_1\)</span> is kept unchanged as some criterion is attained and the region <span class="math inline">\(x_2 \geq s_1\)</span> is split at <span class="math inline">\(x_1 = s_2 = 2.2\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then, the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 &gt; s_2\)</span> is split at <span class="math inline">\(x_1 = s_3 = 3.1\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 \leq s_2\)</span> is split at <span class="math inline">\(x_2 = s_4 = 0.98\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_4, <span class="at">label =</span> <span class="st">"s[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r4x, <span class="at">y=</span>r4y, <span class="at">label =</span> <span class="st">"R[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally only the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 \leq s_2, \mbox{ } x_2 &lt; s_4\)</span> is split at <span class="math inline">\(x_1 = s_5 = 1\)</span>.</p>
<p>The result of this process is a partition into the six regions <span class="math inline">\(R_1, R_2, . . . , R_6\)</span> shown below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_4, <span class="at">label =</span> <span class="st">"s[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r4x, <span class="at">y=</span>r4y, <span class="at">label =</span> <span class="st">"R[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_5, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_5, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r5x, <span class="at">y=</span>r5y, <span class="at">label =</span> <span class="st">"R[5]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_5, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[5]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r6x, <span class="at">y=</span>r6y, <span class="at">label =</span> <span class="st">"R[6]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now seek to understand how CART proceeds to grow a decision tree.</p>
<p>The data set consists of <span class="math inline">\(p\)</span> inputs or predictors and a response variable or output <span class="math inline">\(Y\)</span>, with <span class="math inline">\(n\)</span> observations: <span class="math inline">\((x_i, y_i)\)</span> for <span class="math inline">\(i = 1,\cdots,n\)</span>, and <span class="math inline">\(x_i = (x_{i1},\cdots,x_{ip})\)</span>.</p>
<p>The CART algorithm needs to automatically decide which variables to split on and which split points or threshold to use.</p>
<p>Suppose first that we have a partition into <span class="math inline">\(M\)</span> regions <span class="math inline">\(R_1, R_2, . . . , R_M\)</span>. Given a leaf node <span class="math inline">\(m\)</span> representing a region <span class="math inline">\(R_m\)</span> containing <span class="math inline">\(n_m\)</span> observations, we define for <span class="math inline">\(k \in \{0,1\}\)</span>:</p>
<p><span class="math display">\[
\hat p^m_{k}=\frac{1}{\textrm{Card}\{x_i \in R_m\}}\sum_{x_i \in R_m}\mathbb{1}_{y_i=k}
\]</span></p>
<p>the proportion of response <span class="math inline">\(1\)</span> or <span class="math inline">\(0\)</span> in leaf node <span class="math inline">\(m\)</span>.</p>
<p>CART models the class of output variable as a constant in each region <span class="math inline">\(m\)</span>.</p>
<p>Let <span class="math inline">\(C_m\)</span> be the class of output variable in region <span class="math inline">\(m\)</span>, for <span class="math inline">\(k \in \{0,1\}\)</span> we estimate <span class="math inline">\(\mathbf P(C_m=k)\)</span> with <span class="math inline">\(\hat p^m_{k}\)</span>.</p>
<p>And we classify the region <span class="math inline">\(m\)</span> with <span class="math inline">\(\hat C_m = \underset{k \in \{0,1\}}{\operatorname{argmax}}\hat p^m_{k}\)</span>.</p>
<p>The CART algorithm is recursive (we will propose below a simplified implementation) so that we just have to understand how CART splits a node at any step and more precisely what criterion is used.</p>
<section id="splitting-criterion" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="splitting-criterion"><span class="header-section-number">1.1</span> Splitting criterion</h2>
<p>In order to classify well the data, CART seeks as much as possible to obtain pure leaf nodes (i.e.&nbsp;high probability for one class).</p>
<p>At each step CART selects a predictor <span class="math inline">\(X_j\)</span> and a split-point <span class="math inline">\(s\)</span> such that splitting the current region <span class="math inline">\(\mathcal R\)</span> into the regions <span class="math inline">\(\mathcal R_L(j,s)=\{X|Xj &lt; s\}\)</span> and <span class="math inline">\(\mathcal R_R(j,s)=\{X|Xj ≥ s\}\)</span> leads to the greatest possible reduction in a well chosen measure of impurity.</p>
<p>Given a leaf node <span class="math inline">\(m\)</span> representing a region <span class="math inline">\(R_m\)</span> containing <span class="math inline">\(n_m\)</span> observations we denote <span class="math inline">\(\mathcal I_m\)</span> a measure of node impurity, three measures are usually retained:</p>
<ul>
<li><p>the misclassification error: <span class="math inline">\(\mathcal I_m =\frac{1}{n_m}\sum_{x_i \in R_m}\mathbb{1}_{y_i\neq \hat C_m}= 1-\hat p^m_{\hat C_m}=1-\max(\hat p^m, 1-\hat p^m)\)</span> the fraction of observations in the region that do not belong to the most common class</p></li>
<li><p>the Gini index: <span class="math inline">\(\mathcal I_m=\sum_{k}\hat p^m_{k}(1-\hat p^m_{k})=2\hat p^m(1-\hat p^m)\)</span></p></li>
<li><p>the cross-entropy or deviance: <span class="math inline">\(\mathcal I_m=-\sum_{k} \hat p^m_{k}\log(1-\hat p^m_{k})=-\hat p^m\log(\hat p^m)- (1-\hat p^m)\log(1-\hat p^m)\)</span></p></li>
</ul>
<p>where we have denoted <span class="math inline">\(\hat p^m=\hat p^m_{1}=1-\hat p^m_{0}\)</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>imp_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.01</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>imp_gini <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>imp_gini_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_gini)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>imp_entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">==</span><span class="dv">0</span> <span class="sc">|</span> p<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ent <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    ent <span class="ot">=</span> <span class="sc">-</span>p<span class="sc">*</span><span class="fu">log</span>(p) <span class="sc">-</span> (<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ent</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>imp_entropy_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_entropy)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>imp_misclass <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">-</span><span class="fu">max</span>(p,<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>imp_misclass_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_misclass)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>imp_plot <span class="ot">&lt;-</span> imp_plot  <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gini =</span> <span class="fu">imp_gini_V</span>(x),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">entropy =</span> <span class="fu">imp_entropy_V</span>(x),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">misclass =</span> <span class="fu">imp_misclass_V</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>x, <span class="at">names_to =</span> <span class="st">"impurity"</span>, <span class="at">values_to =</span> <span class="st">"val"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(imp_plot, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>val, <span class="at">col=</span>impurity))<span class="sc">+</span><span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We consider <span class="math inline">\(\mathcal R_L(j,s)\)</span> and <span class="math inline">\(\mathcal R_R(j,s)\)</span> two nodes/regions corresponding to a potential node/region <span class="math inline">\(\mathcal R\)</span> split. Having chosen an impurity measure CART seeks to minimize the weighted average of <span class="math inline">\(\mathcal R_L(j,s)\)</span> and <span class="math inline">\(\mathcal R_R(j,s)\)</span> impurities :</p>
<p><span class="math display">\[
n_L\mathcal I(\mathcal R_L(j,s))+n_R\mathcal I(\mathcal R_R(j,s))
\]</span></p>
<p>A justification to use Gini or Entropy instead of Misclassification is given in <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>: first these two measures are differentiable, hence more amenable to numerical optimization, also considering the following example they favor purity within the nodes:</p>
<ul>
<li>a binary classification problem with <span class="math inline">\(400\)</span> observations per class <span class="math inline">\((400, 400)\)</span></li>
<li>first split: <span class="math inline">\((300, 100)\)</span> with <span class="math inline">\(\hat p^m_0=0.75\)</span> and <span class="math inline">\((100, 300)\)</span> with <span class="math inline">\(\hat p^m_1=0.75\)</span></li>
<li>second split: <span class="math inline">\((200, 400)\)</span> with <span class="math inline">\(\hat p^m_1=0.666\)</span> and <span class="math inline">\((200, 0)\)</span> with with <span class="math inline">\(\hat p^m_0=1\)</span></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>n_l_1 <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>n_r_1 <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>p_l_1 <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>p_r_1<span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>gini_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>entropy_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>misclass_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>n_l_2 <span class="ot">&lt;-</span> <span class="dv">600</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>n_r_2 <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>p_l_2 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>p_r_2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>gini_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>entropy_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>misclass_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We now look at the weighted average impurities for each split:</p>
<ul>
<li>first split : gini: 0.38 / entropy: 0.56 / misclassification: 0.25</li>
<li>second split : gini: 0.33 / entropy: 0.48 / misclassification: 0.25</li>
</ul>
<p>Both splits share a misclassification rate of <span class="math inline">\(0.25\)</span> while Gini and Entropy are decreasing for second split. Intuitively, these two measures will favor purer node than misclassification and are usually preferred in decision tree algorithms.</p>
</section>
<section id="tree-building-process" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="tree-building-process"><span class="header-section-number">1.2</span> Tree-building process</h2>
<p>Having chosen a criterion, the CART algorithm uses top-down, greedy approach that is known as recursive binary splitting:</p>
<ul>
<li><p>top-down: begins at the top of the tree and then recursively splits the input space; each split produces two new branches further down on the tree.</p></li>
<li><p>greedy: at each step of the building process, the best split is made without looking ahead and trying to pick a split that will lead to a better tree in some future step.</p></li>
</ul>
<p><strong>Categorical predictors</strong></p>
<p>Assuming we have a categorical feature with <span class="math inline">\(p\)</span> possible values. We seek the best split into two groups, there is <span class="math inline">\(2^{p-1}-1\)</span> possible splits, which can be prohibitive for large <span class="math inline">\(p\)</span>.</p>
<p>A trick usually implemented, working only for binary classification, is to transform categorical predictors. Usually the proportion of class <span class="math inline">\(1\)</span> for each category is computed, and the algorithm splits on this numerical/ordinal column only needing <span class="math inline">\(p\)</span> splits. This trick and its proof are available in <span class="citation" data-cites="Breiman83">Breiman et al. (<a href="#ref-Breiman83" role="doc-biblioref">1983</a>)</span>.</p>
<p>In <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> it is noted that categorical predictors with many levels usually lead to severe overfitting in the context of decision trees, so that such variables might have to be transformed (by regrouping categories) or avoided.</p>
<p><strong>Implementation for quantitative predictors</strong></p>
<p>We implement below a simple (only working with quantitative variables) and naive recursive method reproducing roughly the CART building process.</p>
<p>First defining the impurity measures:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, y, <span class="at">verbose =</span> <span class="cn">FALSE</span>){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes y is a factor</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>y) <span class="sc">%&gt;%</span> <span class="fu">table</span>()<span class="sc">/</span><span class="fu">nrow</span>(tbl)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {<span class="fu">print</span>(p)}</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="sc">-</span>p<span class="sc">*</span><span class="fu">log2</span>(p<span class="fl">+1e-9</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gini <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, y, <span class="at">verbose =</span> <span class="cn">FALSE</span>){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes y if a factor</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(tbl) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>y) <span class="sc">%&gt;%</span> <span class="fu">table</span>()<span class="sc">/</span><span class="fu">nrow</span>(tbl)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {<span class="fu">print</span>(p)}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then defining a function returning for a given choice of variable and split value, the impurity of the two children nodes and their weighted average impurity:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>impurity_decrease <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_name, split_value, <span class="at">impurity =</span> gini, <span class="at">min_leaf =</span> <span class="dv">5</span>){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    ret_default <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"impurity_left"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span><span class="ot">=</span><span class="dv">666</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&lt;</span> <span class="sc">!!</span>split_value)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    n_left <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_left)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_left <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)} </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    impurity_left <span class="ot">&lt;-</span> <span class="fu">impurity</span>(tbl_left, y_name)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&gt;=!!</span>split_value)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    n_right <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_right)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_right <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    impurity_right <span class="ot">&lt;-</span> <span class="fu">impurity</span>(tbl_right, y_name)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"impurity_left"</span><span class="ot">=</span>impurity_left,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span><span class="ot">=</span>impurity_right,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span><span class="ot">=</span>n_left<span class="sc">/</span>(n_left<span class="sc">+</span>n_right)<span class="sc">*</span>impurity_left<span class="sc">+</span> n_right<span class="sc">/</span>(n_left<span class="sc">+</span>n_right)<span class="sc">*</span>impurity_right))</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using this function and given a node, this functions seeks for each variable <span class="math inline">\(j\)</span> and split value <span class="math inline">\(s\)</span>, the best split in terms of weighted average impurity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>max_impurity_decrease <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_names, <span class="at">impurity =</span> gini, <span class="at">min_leaf =</span> <span class="dv">5</span>){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    imp_node <span class="ot">=</span> <span class="fu">impurity</span>(tbl_node, y_name)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    list_all_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    tbl_res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="st">"zzz"</span>, <span class="at">split_rule =</span> <span class="sc">-</span><span class="dv">666</span>, <span class="at">imp_left =</span> <span class="dv">666</span>, <span class="at">imp_right =</span> <span class="dv">666</span>, <span class="at">imp_total =</span> <span class="dv">666</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (x_name <span class="cf">in</span> x_names){</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        list_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>       <span class="co"># print(x_name)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (split <span class="cf">in</span> <span class="fu">unique</span>(tbl_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x_name))){</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(split)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            imp_dec <span class="ot">&lt;-</span> <span class="fu">impurity_decrease</span>(tbl_node, y_name, x_name, split, impurity, min_leaf)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="co"># list_x[[j]] &lt;- c(split, imp_dec)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            tbl_res <span class="ot">&lt;-</span>  <span class="fu">bind_rows</span>(tbl_res,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="fu">as.character</span>(x_name),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">split_rule =</span> split,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_node =</span> imp_node,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_left =</span> imp_dec[[<span class="st">"impurity_left"</span>]],</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_right =</span> imp_dec[[<span class="st">"impurity_right"</span>]],</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_total =</span> imp_dec[[<span class="st">"impurity_total"</span>]]))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        }   </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tbl_res)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We test this function with the mixture data set, starting at the root node:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">max_impurity_decrease</span>(tbl_node, y_name, x_names)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>(test <span class="ot">&lt;-</span>test <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>, imp_total <span class="sc">!=</span> <span class="dv">666</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(imp_total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.150864353","3":"0.14201183","4":"0.4558072","5":"0.3742204","6":"0.5"},{"1":"x2","2":"0.551403559","3":"0.30764301","4":"0.4180042","5":"0.3744115","6":"0.5"},{"1":"x2","2":"0.137389748","3":"0.14455978","4":"0.4583577","5":"0.3783393","6":"0.5"},{"1":"x2","2":"0.544177695","3":"0.31065089","4":"0.4226015","5":"0.3789407","6":"0.5"},{"1":"x2","2":"0.556946627","3":"0.32000000","4":"0.4200000","5":"0.3800000","6":"0.5"},{"1":"x2","2":"0.165052639","3":"0.17087932","4":"0.4572169","5":"0.3813374","6":"0.5"},{"1":"x2","2":"0.102975324","3":"0.14720000","4":"0.4608000","5":"0.3824000","6":"0.5"},{"1":"x2","2":"0.525151558","3":"0.31371226","4":"0.4269945","5":"0.3833808","6":"0.5"},{"1":"x2","2":"0.404037972","3":"0.28408163","4":"0.4373964","5":"0.3837363","6":"0.5"},{"1":"x2","2":"0.936223312","3":"0.40123457","4":"0.3638941","5":"0.3840580","6":"0.5"},{"1":"x2","2":"0.186156137","3":"0.19438017","4":"0.4560285","5":"0.3840752","6":"0.5"},{"1":"x2","2":"0.918180475","3":"0.39747241","4":"0.3696243","5":"0.3843838","6":"0.5"},{"1":"x2","2":"0.470747125","3":"0.29591049","4":"0.4354248","5":"0.3851997","6":"0.5"},{"1":"x2","2":"0.585843888","3":"0.33165676","4":"0.4220041","5":"0.3854134","6":"0.5"},{"1":"x2","2":"0.361734172","3":"0.27444865","4":"0.4427610","5":"0.3863764","6":"0.5"},{"1":"x2","2":"0.073293605","3":"0.14993753","4":"0.4631376","5":"0.3864036","6":"0.5"},{"1":"x2","2":"0.215211634","3":"0.21545091","4":"0.4547900","5":"0.3865783","6":"0.5"},{"1":"x2","2":"0.505121685","3":"0.31682825","4":"0.4311915","5":"0.3877334","6":"0.5"},{"1":"x2","2":"0.379000419","3":"0.28733459","4":"0.4409999","5":"0.3879854","6":"0.5"},{"1":"x2","2":"0.184898617","3":"0.19753086","4":"0.4586226","5":"0.3881279","6":"0.5"},{"1":"x2","2":"0.725799603","3":"0.36056054","4":"0.4103563","5":"0.3881972","6":"0.5"},{"1":"x2","2":"0.959990564","3":"0.40703644","4":"0.3666224","5":"0.3886480","6":"0.5"},{"1":"x2","2":"0.742267953","3":"0.36662239","4":"0.4070364","5":"0.3886480","6":"0.5"},{"1":"x2","2":"0.919702238","3":"0.40352869","4":"0.3722974","5":"0.3890061","6":"0.5"},{"1":"x2","2":"0.910978474","3":"0.39981859","4":"0.3776177","5":"0.3892732","6":"0.5"},{"1":"x2","2":"0.413648012","3":"0.29914699","4":"0.4391563","5":"0.3894530","6":"0.5"},{"1":"x2","2":"0.070452553","3":"0.15277778","4":"0.4653740","5":"0.3903509","6":"0.5"},{"1":"x2","2":"0.358477769","3":"0.27777778","4":"0.4460904","5":"0.3905473","6":"0.5"},{"1":"x2","2":"0.207323551","3":"0.21875000","4":"0.4574653","5":"0.3906250","6":"0.5"},{"1":"x2","2":"0.649705578","3":"0.34265318","4":"0.4240161","5":"0.3906573","6":"0.5"},{"1":"x2","2":"0.481080499","3":"0.31000188","4":"0.4372249","5":"0.3907885","6":"0.5"},{"1":"x2","2":"0.490536018","3":"0.32000000","4":"0.4352000","5":"0.3920000","6":"0.5"},{"1":"x2","2":"0.362826378","3":"0.29065744","4":"0.4444444","5":"0.3921569","6":"0.5"},{"1":"x2","2":"0.717486166","3":"0.36337810","4":"0.4156569","5":"0.3926542","6":"0.5"},{"1":"x2","2":"0.979110495","3":"0.41565689","4":"0.3633781","5":"0.3926542","6":"0.5"},{"1":"x2","2":"0.240936940","3":"0.23781213","4":"0.4562587","5":"0.3929092","6":"0.5"},{"1":"x2","2":"0.738892516","3":"0.36938272","4":"0.4125620","5":"0.3931313","6":"0.5"},{"1":"x2","2":"0.961948009","3":"0.41256198","4":"0.3693827","5":"0.3931313","6":"0.5"},{"1":"x2","2":"0.771731486","3":"0.37500000","4":"0.4092936","5":"0.3935185","6":"0.5"},{"1":"x2","2":"0.801422708","3":"0.38026256","4":"0.4058384","5":"0.3938177","6":"0.5"},{"1":"x2","2":"0.901675787","3":"0.40218195","4":"0.3851997","5":"0.3940304","6":"0.5"},{"1":"x2","2":"0.031462099","3":"0.15572657","4":"0.4675125","5":"0.3942428","6":"0.5"},{"1":"x2","2":"0.347995798","3":"0.28118343","4":"0.4492730","5":"0.3946439","6":"0.5"},{"1":"x2","2":"0.020693004","3":"0.12706612","4":"0.4703320","5":"0.3948135","6":"0.5"},{"1":"x2","2":"0.654564443","3":"0.35302656","4":"0.4260355","5":"0.3957368","6":"0.5"},{"1":"x2","2":"0.484102460","3":"0.32322863","4":"0.4390275","5":"0.3961819","6":"0.5"},{"1":"x2","2":"1.026506205","3":"0.42344045","4":"0.3598616","5":"0.3964194","6":"0.5"},{"1":"x2","2":"0.705004818","3":"0.36623068","4":"0.4207064","5":"0.3970095","6":"0.5"},{"1":"x2","2":"0.992199616","3":"0.42070640","4":"0.3662307","5":"0.3970095","6":"0.5"},{"1":"x2","2":"0.973755498","3":"0.41782323","4":"0.3721752","5":"0.3975099","6":"0.5"},{"1":"x2","2":"0.025438551","3":"0.15879017","4":"0.4695564","5":"0.3980802","6":"0.5"},{"1":"x2","2":"0.777194034","3":"0.38293444","4":"0.4115643","5":"0.3982514","6":"0.5"},{"1":"x2","2":"0.809050152","3":"0.38781163","4":"0.4081633","5":"0.3984962","6":"0.5"},{"1":"x2","2":"0.017201649","3":"0.12979989","4":"0.4722301","5":"0.3986076","6":"0.5"},{"1":"x2","2":"0.886232609","3":"0.40456216","4":"0.3923903","5":"0.3986588","6":"0.5"},{"1":"x2","2":"0.326034294","3":"0.28466797","4":"0.4523140","5":"0.3986673","6":"0.5"},{"1":"x2","2":"0.272584762","3":"0.25854639","4":"0.4577235","5":"0.3989662","6":"0.5"},{"1":"x2","2":"1.038922700","3":"0.42806183","4":"0.3628118","5":"0.4006568","6":"0.5"},{"1":"x2","2":"0.665912397","3":"0.36281179","4":"0.4280618","5":"0.4006568","6":"0.5"},{"1":"x2","2":"0.306475077","3":"0.27411986","4":"0.4564981","5":"0.4008727","6":"0.5"},{"1":"x2","2":"1.008993039","3":"0.42551554","4":"0.3691184","5":"0.4012648","6":"0.5"},{"1":"x2","2":"0.693601574","3":"0.36911844","4":"0.4255155","5":"0.4012648","6":"0.5"},{"1":"x2","2":"0.022464061","3":"0.16197531","4":"0.4715088","5":"0.4018638","6":"0.5"},{"1":"x2","2":"0.009673168","3":"0.13265306","4":"0.4740426","5":"0.4023508","6":"0.5"},{"1":"x2","2":"0.323311979","3":"0.28823381","4":"0.4552187","5":"0.4026185","6":"0.5"},{"1":"x2","2":"0.812967619","3":"0.39496528","4":"0.4105030","5":"0.4030449","6":"0.5"},{"1":"x2","2":"0.883552173","3":"0.40695886","4":"0.3992087","5":"0.4031613","6":"0.5"},{"1":"x2","2":"0.287959243","3":"0.27777778","4":"0.4591837","5":"0.4047619","6":"0.5"},{"1":"x2","2":"1.039167443","3":"0.43246402","4":"0.3658006","5":"0.4047987","6":"0.5"},{"1":"x2","2":"0.672350664","3":"0.37204152","4":"0.4300945","5":"0.4054220","6":"0.5"},{"1":"x2","2":"-0.029746130","3":"0.13563355","4":"0.4757723","5":"0.4060439","6":"0.5"},{"1":"x2","2":"0.321050446","3":"0.29188345","4":"0.4579920","5":"0.4064984","6":"0.5"},{"1":"x2","2":"0.813721723","3":"0.40174301","4":"0.4128570","5":"0.4074667","6":"0.5"},{"1":"x2","2":"0.876644795","3":"0.40937163","4":"0.4056729","5":"0.4075408","6":"0.5"},{"1":"x2","2":"-0.330735232","3":"0.00000000","4":"0.4831764","5":"0.4082840","6":"0.5"},{"1":"x2","2":"1.039996187","3":"0.43665613","4":"0.3688281","5":"0.4088466","6":"0.5"},{"1":"x2","2":"-0.064545302","3":"0.13875000","4":"0.4774219","5":"0.4096875","6":"0.5"},{"1":"x2","2":"-0.357915928","3":"0.00000000","4":"0.4844291","5":"0.4117647","6":"0.5"},{"1":"x2","2":"0.852322687","3":"0.40816327","4":"0.4152249","5":"0.4117647","6":"0.5"},{"1":"x2","2":"0.867253738","3":"0.41180000","4":"0.4118000","5":"0.4118000","6":"0.5"},{"1":"x2","2":"1.052235708","3":"0.44064685","4":"0.3718945","5":"0.4128022","6":"0.5"},{"1":"x2","2":"-0.294440957","3":"0.05876951","4":"0.4827710","5":"0.4128107","6":"0.5"},{"1":"x2","2":"-0.166103051","3":"0.10493827","4":"0.4809637","5":"0.4132791","6":"0.5"},{"1":"x2","2":"-0.085187569","3":"0.14201183","4":"0.4789939","5":"0.4132824","6":"0.5"},{"1":"x2","2":"-0.418277898","3":"0.00000000","4":"0.4856195","5":"0.4152047","6":"0.5"},{"1":"x2","2":"1.170055270","3":"0.45568440","4":"0.3402647","5":"0.4158646","6":"0.5"},{"1":"x2","2":"1.085183909","3":"0.44625101","4":"0.3685076","5":"0.4159311","6":"0.5"},{"1":"x2","2":"0.855519879","3":"0.41424344","4":"0.4176061","5":"0.4159416","6":"0.5"},{"1":"x2","2":"-0.309811219","3":"0.06054688","4":"0.4840561","5":"0.4162946","6":"0.5"},{"1":"x2","2":"1.058147178","3":"0.44444444","4":"0.3750000","5":"0.4166667","6":"0.5"},{"1":"x2","2":"-0.271033290","3":"0.10775510","4":"0.4823508","5":"0.4167965","6":"0.5"},{"1":"x2","2":"-0.109150387","3":"0.14542936","4":"0.4804908","5":"0.4168291","6":"0.5"},{"1":"x2","2":"1.165593851","3":"0.45429962","4":"0.3491371","5":"0.4169669","6":"0.5"},{"1":"x2","2":"-0.454657409","3":"0.00000000","4":"0.4867496","5":"0.4186047","6":"0.5"},{"1":"x2","2":"1.174771281","3":"0.45856290","4":"0.3438581","5":"0.4195633","6":"0.5"},{"1":"x2","2":"1.090314031","3":"0.44973230","4":"0.3717322","5":"0.4197022","6":"0.5"},{"1":"x2","2":"-0.283878559","3":"0.11072664","4":"0.4836696","5":"0.4202693","6":"0.5"},{"1":"x2","2":"-0.165204649","3":"0.14901388","4":"0.4819150","5":"0.4203283","6":"0.5"},{"1":"x2","2":"1.079833767","3":"0.44805683","4":"0.3781445","5":"0.4204415","6":"0.5"},{"1":"x2","2":"1.167759713","3":"0.45727811","4":"0.3526531","5":"0.4206593","6":"0.5"},{"1":"x2","2":"1.154179996","3":"0.45593262","4":"0.3607253","5":"0.4216580","6":"0.5"},{"1":"x2","2":"-0.455959142","3":"0.00000000","4":"0.4878212","5":"0.4219653","6":"0.5"},{"1":"x2","2":"1.223981852","3":"0.46244170","4":"0.3379882","5":"0.4219943","6":"0.5"},{"1":"x2","2":"1.135668449","3":"0.45452255","4":"0.3681519","5":"0.4225654","6":"0.5"},{"1":"x2","2":"1.201221704","3":"0.46130364","4":"0.3475162","5":"0.4231848","6":"0.5"},{"1":"x2","2":"1.103914441","3":"0.45304370","4":"0.3750000","5":"0.4233871","6":"0.5"},{"1":"x2","2":"-0.479446546","3":"0.00000000","4":"0.4888360","5":"0.4252874","6":"0.5"},{"1":"x2","2":"1.242869428","3":"0.46496540","4":"0.3417969","5":"0.4255515","6":"0.5"},{"1":"x2","2":"1.148315275","3":"0.45756092","4":"0.3715519","5":"0.4261676","6":"0.5"},{"1":"x2","2":"1.216216381","3":"0.46391178","4":"0.3512397","5":"0.4267300","6":"0.5"},{"1":"x2","2":"1.107883553","3":"0.45619200","4":"0.3783111","5":"0.4269867","6":"0.5"},{"1":"x2","2":"-0.481920759","3":"0.00000000","4":"0.4897959","5":"0.4285714","6":"0.5"},{"1":"x2","2":"1.250357925","3":"0.46736640","4":"0.3456790","5":"0.4290349","6":"0.5"},{"1":"x2","2":"1.283185943","3":"0.47133505","4":"0.3281807","5":"0.4298203","6":"0.5"},{"1":"x2","2":"1.384068805","3":"0.47410226","4":"0.3200000","5":"0.4317241","6":"0.5"},{"1":"x2","2":"-0.530621080","3":"0.00000000","4":"0.4907025","5":"0.4318182","6":"0.5"},{"1":"x2","2":"1.250970789","3":"0.46964923","4":"0.3496358","5":"0.4324451","6":"0.5"},{"1":"x2","2":"1.357381623","3":"0.47337278","4":"0.3324100","5":"0.4331984","6":"0.5"},{"1":"x2","2":"1.276901247","3":"0.47261204","4":"0.3435794","5":"0.4345474","6":"0.5"},{"1":"x2","2":"-0.551650278","3":"0.00000000","4":"0.4915573","5":"0.4350282","6":"0.5"},{"1":"x2","2":"1.384600180","3":"0.47598048","4":"0.3244170","5":"0.4350583","6":"0.5"},{"1":"x2","2":"1.460543433","3":"0.47892636","4":"0.2998751","5":"0.4350588","6":"0.5"},{"1":"x2","2":"1.261365481","3":"0.47181823","4":"0.3536684","5":"0.4357825","6":"0.5"},{"1":"x2","2":"1.358509888","3":"0.47530864","4":"0.3367347","5":"0.4365079","6":"0.5"},{"1":"x2","2":"1.427912819","3":"0.47835683","4":"0.3152634","5":"0.4367680","6":"0.5"},{"1":"x2","2":"-0.733347412","3":"0.00000000","4":"0.4923621","5":"0.4382022","6":"0.5"},{"1":"x2","2":"1.489829603","3":"0.48052285","4":"0.3046875","5":"0.4383224","6":"0.5"},{"1":"x2","2":"1.398988842","3":"0.47776389","4":"0.3289427","5":"0.4383263","6":"0.5"},{"1":"x2","2":"1.273747315","3":"0.47387755","4":"0.3577778","5":"0.4390476","6":"0.5"},{"1":"x2","2":"1.457361044","3":"0.48000000","4":"0.3200000","5":"0.4400000","6":"0.5"},{"1":"x2","2":"-0.737176464","3":"0.00000000","4":"0.4931182","5":"0.4413408","6":"0.5"},{"1":"x2","2":"1.491832426","3":"0.48203682","4":"0.3096424","5":"0.4415241","6":"0.5"},{"1":"x2","2":"1.418180412","3":"0.47945581","4":"0.3335799","5":"0.4415281","6":"0.5"},{"1":"x2","2":"1.633062578","3":"0.48593804","4":"0.2603550","5":"0.4419494","6":"0.5"},{"1":"x2","2":"-0.742851486","3":"0.00000000","4":"0.4938272","5":"0.4444444","6":"0.5"},{"1":"x2","2":"1.545476693","3":"0.48347107","4":"0.3147448","5":"0.4446640","6":"0.5"},{"1":"x2","2":"1.647575574","3":"0.48712087","4":"0.2659280","5":"0.4450942","6":"0.5"},{"1":"x2","2":"1.625783044","3":"0.48679688","4":"0.2887500","5":"0.4471875","6":"0.5"},{"1":"x2","2":"-0.744933603","3":"0.00000000","4":"0.4944904","5":"0.4475138","6":"0.5"},{"1":"x2","2":"1.550985579","3":"0.48482830","4":"0.3200000","5":"0.4477419","6":"0.5"},{"1":"x2","2":"1.704139810","3":"0.48823817","4":"0.2717312","5":"0.4481844","6":"0.5"},{"1":"x2","2":"2.015033249","3":"0.49280000","4":"0.1472000","5":"0.4496000","6":"0.5"},{"1":"x2","2":"-0.761847144","3":"0.00000000","4":"0.4951093","5":"0.4505495","6":"0.5"},{"1":"x2","2":"1.565475021","3":"0.48611111","4":"0.3254132","5":"0.4507576","6":"0.5"},{"1":"x2","2":"1.714859663","3":"0.48929209","4":"0.2777778","5":"0.4512195","6":"0.5"},{"1":"x2","2":"1.608536949","3":"0.48763894","4":"0.3140988","5":"0.4520632","6":"0.5"},{"1":"x2","2":"2.041098516","3":"0.49354339","4":"0.1527778","5":"0.4526515","6":"0.5"},{"1":"x2","2":"2.002274242","3":"0.49263256","4":"0.1975309","5":"0.4527938","6":"0.5"},{"1":"x1","2":"-0.912620059","3":"0.00000000","4":"0.4956852","5":"0.4535519","6":"0.5"},{"1":"x2","2":"-0.787134923","3":"0.00000000","4":"0.4956852","5":"0.4535519","6":"0.5"},{"1":"x2","2":"1.577942178","3":"0.48732200","4":"0.3309897","5":"0.4537106","6":"0.5"},{"1":"x2","2":"1.718885398","3":"0.49028466","4":"0.2840816","5":"0.4541991","6":"0.5"},{"1":"x2","2":"2.052686203","3":"0.49423856","4":"0.1587902","5":"0.4556620","6":"0.5"},{"1":"x2","2":"2.007981737","3":"0.49339411","4":"0.2041420","5":"0.4557913","6":"0.5"},{"1":"x1","2":"-1.021784128","3":"0.00000000","4":"0.4962193","5":"0.4565217","6":"0.5"},{"1":"x2","2":"-0.830414760","3":"0.00000000","4":"0.4962193","5":"0.4565217","6":"0.5"},{"1":"x2","2":"1.580805445","3":"0.48846339","4":"0.3367347","5":"0.4566004","6":"0.5"},{"1":"x2","2":"1.735423774","3":"0.49121788","4":"0.2906574","5":"0.4571226","6":"0.5"},{"1":"x2","2":"1.930257493","3":"0.49323959","4":"0.2448980","5":"0.4584718","6":"0.5"},{"1":"x2","2":"2.075904398","3":"0.49488701","4":"0.1652893","5":"0.4586313","6":"0.5"},{"1":"x1","2":"-1.136539074","3":"0.00000000","4":"0.4967129","5":"0.4594595","6":"0.5"},{"1":"x2","2":"-0.901759351","3":"0.00000000","4":"0.4967129","5":"0.4594595","6":"0.5"},{"1":"x2","2":"1.757231990","3":"0.49209366","4":"0.2975207","5":"0.4599891","6":"0.5"},{"1":"x1","2":"-0.840369051","3":"0.10493827","4":"0.4961357","5":"0.4609280","6":"0.5"},{"1":"x2","2":"2.108804862","3":"0.49549015","4":"0.1723356","5":"0.4615589","6":"0.5"},{"1":"x1","2":"-0.109159157","3":"0.36938272","4":"0.4889906","5":"0.4620789","6":"0.5"},{"1":"x1","2":"-1.162763070","3":"0.00000000","4":"0.4971673","5":"0.4623656","6":"0.5"},{"1":"x2","2":"-0.903565594","3":"0.00000000","4":"0.4971673","5":"0.4623656","6":"0.5"},{"1":"x2","2":"1.805299380","3":"0.49291383","4":"0.3046875","5":"0.4627976","6":"0.5"},{"1":"x1","2":"-0.191272364","3":"0.36281179","4":"0.4903060","5":"0.4635322","6":"0.5"},{"1":"x2","2":"1.881741308","3":"0.49382716","4":"0.2853746","5":"0.4636015","6":"0.5"},{"1":"x1","2":"-0.727077155","3":"0.18000000","4":"0.4960494","5":"0.4644444","6":"0.5"},{"1":"x2","2":"2.125607235","3":"0.49604938","4":"0.1800000","5":"0.4644444","6":"0.5"},{"1":"x1","2":"-0.313007477","3":"0.32698962","4":"0.4927421","5":"0.4645641","6":"0.5"},{"1":"x1","2":"2.071415038","3":"0.49274205","4":"0.3269896","5":"0.4645641","6":"0.5"},{"1":"x1","2":"-0.152822409","3":"0.37500000","4":"0.4900559","5":"0.4647436","6":"0.5"},{"1":"x1","2":"-1.169258605","3":"0.00000000","4":"0.4975836","5":"0.4652406","6":"0.5"},{"1":"x2","2":"-0.919790286","3":"0.00000000","4":"0.4975836","5":"0.4652406","6":"0.5"},{"1":"x2","2":"1.860080951","3":"0.49368019","4":"0.3121748","5":"0.4655469","6":"0.5"},{"1":"x1","2":"0.066332192","3":"0.42000000","4":"0.4853061","5":"0.4657143","6":"0.5"},{"1":"x1","2":"1.640157488","3":"0.48979592","4":"0.3856333","5":"0.4658385","6":"0.5"},{"1":"x1","2":"-0.079583353","3":"0.38563327","4":"0.4897959","5":"0.4658385","6":"0.5"},{"1":"x1","2":"-0.302274664","3":"0.34567901","4":"0.4925640","5":"0.4661247","6":"0.5"},{"1":"x1","2":"-0.196246334","3":"0.36882808","4":"0.4912780","5":"0.4661758","6":"0.5"},{"1":"x1","2":"2.125104790","3":"0.49352791","4":"0.3342516","5":"0.4672473","6":"0.5"},{"1":"x1","2":"-0.368775793","3":"0.33425161","4":"0.4935279","5":"0.4672473","6":"0.5"},{"1":"x1","2":"-0.804293855","3":"0.18836565","4":"0.4965660","5":"0.4672870","6":"0.5"},{"1":"x2","2":"2.142041681","3":"0.49656604","4":"0.1883657","5":"0.4672870","6":"0.5"},{"1":"x1","2":"-0.167523862","3":"0.38074635","4":"0.4910544","5":"0.4673382","6":"0.5"},{"1":"x1","2":"0.033318463","3":"0.41859034","4":"0.4870654","5":"0.4675500","6":"0.5"},{"1":"x1","2":"-1.256441709","3":"0.00000000","4":"0.4979629","5":"0.4680851","6":"0.5"},{"1":"x2","2":"-1.014726822","3":"0.00000000","4":"0.4979629","5":"0.4680851","6":"0.5"},{"1":"x1","2":"0.061145537","3":"0.42401609","4":"0.4866958","5":"0.4682053","6":"0.5"},{"1":"x2","2":"1.877590719","3":"0.49439446","4":"0.3200000","5":"0.4682353","6":"0.5"},{"1":"x1","2":"1.642844649","3":"0.49082206","4":"0.3911111","5":"0.4683871","6":"0.5"},{"1":"x1","2":"-0.311647982","3":"0.35265306","4":"0.4933701","5":"0.4687446","6":"0.5"},{"1":"x1","2":"1.945429440","3":"0.49337006","4":"0.3526531","5":"0.4687446","6":"0.5"},{"1":"x1","2":"-0.200683161","3":"0.37500000","4":"0.4921875","5":"0.4687500","6":"0.5"},{"1":"x1","2":"0.087614787","3":"0.42891696","4":"0.4863102","5":"0.4688053","6":"0.5"},{"1":"x1","2":"-0.077114461","3":"0.40018108","4":"0.4905805","5":"0.4693367","6":"0.5"},{"1":"x1","2":"1.623801765","3":"0.49058055","4":"0.4001811","5":"0.4693367","6":"0.5"},{"1":"x1","2":"0.129985619","3":"0.43335853","4":"0.4859076","5":"0.4693547","6":"0.5"},{"1":"x1","2":"2.126868516","3":"0.49426020","4":"0.3417969","5":"0.4698661","6":"0.5"},{"1":"x1","2":"-0.369493348","3":"0.34179688","4":"0.4942602","5":"0.4698661","6":"0.5"},{"1":"x1","2":"0.013973130","3":"0.42283163","4":"0.4883295","5":"0.4699901","6":"0.5"},{"1":"x1","2":"-0.295362353","3":"0.36815194","4":"0.4932064","5":"0.4700713","6":"0.5"},{"1":"x1","2":"-0.715283835","3":"0.24489796","4":"0.4964889","5":"0.4700718","6":"0.5"},{"1":"x2","2":"2.181549767","3":"0.49704142","4":"0.1975309","5":"0.4700855","6":"0.5"},{"1":"x1","2":"0.056184431","3":"0.42806183","4":"0.4879984","5":"0.4706168","6":"0.5"},{"1":"x1","2":"2.262714148","3":"0.49505831","4":"0.3281807","5":"0.4708611","6":"0.5"},{"1":"x1","2":"1.715233331","3":"0.49178172","4":"0.3966942","5":"0.4708625","6":"0.5"},{"1":"x1","2":"-1.264860817","3":"0.00000000","4":"0.4983063","5":"0.4708995","6":"0.5"},{"1":"x2","2":"-1.023014058","3":"0.00000000","4":"0.4983063","5":"0.4708995","6":"0.5"},{"1":"x1","2":"-0.053430597","3":"0.41522491","4":"0.4900680","5":"0.4709830","6":"0.5"},{"1":"x1","2":"1.532257922","3":"0.49006801","4":"0.4152249","5":"0.4709830","6":"0.5"},{"1":"x1","2":"-0.257136280","3":"0.38132807","4":"0.4930365","5":"0.4712534","6":"0.5"},{"1":"x1","2":"1.520914290","3":"0.48979592","4":"0.4215023","5":"0.4716981","6":"0.5"},{"1":"x1","2":"0.125021393","3":"0.43704475","4":"0.4872926","5":"0.4717158","6":"0.5"},{"1":"x1","2":"0.134347469","3":"0.44091797","4":"0.4869161","5":"0.4721967","6":"0.5"},{"1":"x1","2":"1.749188014","3":"0.49286025","4":"0.3926234","5":"0.4723117","6":"0.5"},{"1":"x1","2":"0.008130556","3":"0.42710744","4":"0.4895125","5":"0.4723511","6":"0.5"},{"1":"x1","2":"2.196544935","3":"0.49494065","4":"0.3496358","5":"0.4724184","6":"0.5"},{"1":"x1","2":"-0.370309590","3":"0.34963580","4":"0.4949407","5":"0.4724184","6":"0.5"},{"1":"x1","2":"1.926571814","3":"0.49397680","4":"0.3750000","5":"0.4725610","6":"0.5"},{"1":"x1","2":"-0.074079101","3":"0.41319444","4":"0.4913435","5":"0.4725877","6":"0.5"},{"1":"x1","2":"1.613212710","3":"0.49134349","4":"0.4131944","5":"0.4725877","6":"0.5"},{"1":"x2","2":"2.207488935","3":"0.49747678","4":"0.2076125","5":"0.4728383","6":"0.5"},{"1":"x1","2":"1.725681429","3":"0.49267719","4":"0.4023797","5":"0.4732632","6":"0.5"},{"1":"x1","2":"1.576976508","3":"0.49111111","4":"0.4200000","5":"0.4733333","6":"0.5"},{"1":"x1","2":"-0.071295170","3":"0.42000000","4":"0.4911111","5":"0.4733333","6":"0.5"},{"1":"x1","2":"-0.429649585","3":"0.33673469","4":"0.4956733","5":"0.4734219","6":"0.5"},{"1":"x1","2":"2.285264980","3":"0.49567334","4":"0.3367347","5":"0.4734219","6":"0.5"},{"1":"x1","2":"-1.464690853","3":"0.00000000","4":"0.4986150","5":"0.4736842","6":"0.5"},{"1":"x2","2":"-1.082164290","3":"0.00000000","4":"0.4986150","5":"0.4736842","6":"0.5"},{"1":"x1","2":"1.897709107","3":"0.49382716","4":"0.3878116","5":"0.4736842","6":"0.5"},{"1":"x1","2":"-0.264756676","3":"0.38781163","4":"0.4938272","5":"0.4736842","6":"0.5"},{"1":"x1","2":"0.267442252","3":"0.45331790","4":"0.4852295","5":"0.4737413","6":"0.5"},{"1":"x1","2":"-0.019836616","3":"0.42603550","4":"0.4908692","5":"0.4740125","6":"0.5"},{"1":"x1","2":"1.522310375","3":"0.49086925","4":"0.4260355","5":"0.4740125","6":"0.5"},{"1":"x1","2":"0.005244683","3":"0.43141289","4":"0.4906174","5":"0.4746322","6":"0.5"},{"1":"x1","2":"1.518293955","3":"0.49061738","4":"0.4314129","5":"0.4746322","6":"0.5"},{"1":"x1","2":"1.816825183","3":"0.49367187","4":"0.3987500","5":"0.4746875","6":"0.5"},{"1":"x1","2":"0.192282525","3":"0.44781065","4":"0.4879012","5":"0.4748718","6":"0.5"},{"1":"x1","2":"-0.400761723","3":"0.35777778","4":"0.4955709","5":"0.4749020","6":"0.5"},{"1":"x1","2":"2.228716379","3":"0.49557093","4":"0.3577778","5":"0.4749020","6":"0.5"},{"1":"x1","2":"-0.681595736","3":"0.29752066","4":"0.4969070","5":"0.4749745","6":"0.5"},{"1":"x2","2":"2.242263910","3":"0.49787335","4":"0.2187500","5":"0.4755435","6":"0.5"},{"1":"x1","2":"1.741742104","3":"0.49351066","4":"0.4081633","5":"0.4755877","6":"0.5"},{"1":"x1","2":"-0.071974368","3":"0.42482299","4":"0.4920837","5":"0.4756048","6":"0.5"},{"1":"x1","2":"1.591324822","3":"0.49208368","4":"0.4248230","5":"0.4756048","6":"0.5"},{"1":"x1","2":"2.290042376","3":"0.49624110","4":"0.3456790","5":"0.4759152","6":"0.5"},{"1":"x1","2":"-0.487292651","3":"0.34567901","4":"0.4962411","5":"0.4759152","6":"0.5"},{"1":"x1","2":"0.259433566","3":"0.45625868","4":"0.4867496","5":"0.4759253","6":"0.5"},{"1":"x1","2":"1.925173384","3":"0.49456133","4":"0.3944485","5":"0.4760405","6":"0.5"},{"1":"x1","2":"0.310785039","3":"0.45862263","4":"0.4863290","5":"0.4762162","6":"0.5"},{"1":"x1","2":"-1.529105572","3":"0.00000000","4":"0.4988898","5":"0.4764398","6":"0.5"},{"1":"x2","2":"-1.095889767","3":"0.00000000","4":"0.4988898","5":"0.4764398","6":"0.5"},{"1":"x1","2":"-0.589045843","3":"0.32986111","4":"0.4968363","5":"0.4767992","6":"0.5"},{"1":"x1","2":"-0.019593015","3":"0.43574226","4":"0.4916470","5":"0.4768322","6":"0.5"},{"1":"x1","2":"1.870899745","3":"0.49442537","4":"0.4049967","5":"0.4769868","6":"0.5"},{"1":"x1","2":"-0.414441664","3":"0.36623068","4":"0.4961527","5":"0.4773140","6":"0.5"},{"1":"x1","2":"1.510827689","3":"0.49141498","4":"0.4403306","5":"0.4773668","6":"0.5"},{"1":"x1","2":"0.205190129","3":"0.45408632","4":"0.4888617","5":"0.4773858","6":"0.5"},{"1":"x1","2":"0.248728401","3":"0.45674740","4":"0.4885216","5":"0.4777184","6":"0.5"},{"1":"x1","2":"0.258880758","3":"0.45918367","4":"0.4881657","5":"0.4780220","6":"0.5"},{"1":"x2","2":"2.255267507","3":"0.49823229","4":"0.2311111","5":"0.4781982","6":"0.5"},{"1":"x1","2":"2.342765510","3":"0.49676311","4":"0.3550296","5":"0.4783378","6":"0.5"},{"1":"x1","2":"-0.570429501","3":"0.35502959","4":"0.4967631","5":"0.4783378","6":"0.5"},{"1":"x1","2":"0.319988146","3":"0.46347699","4":"0.4874024","5":"0.4785500","6":"0.5"},{"1":"x1","2":"-1.776926087","3":"0.00000000","4":"0.4991319","5":"0.4791667","6":"0.5"},{"1":"x2","2":"-1.113541170","3":"0.00000000","4":"0.4991319","5":"0.4791667","6":"0.5"},{"1":"x1","2":"-0.668445480","3":"0.34026465","4":"0.4973028","5":"0.4792434","6":"0.5"},{"1":"x1","2":"0.205456121","3":"0.45979060","4":"0.4897959","5":"0.4797441","6":"0.5"},{"1":"x1","2":"1.486247706","3":"0.49218750","4":"0.4483418","5":"0.4799107","6":"0.5"},{"1":"x1","2":"0.256750222","3":"0.46208780","4":"0.4894820","5":"0.4800310","6":"0.5"},{"1":"x1","2":"1.467109246","3":"0.49196588","4":"0.4518430","5":"0.4803303","6":"0.5"},{"1":"x1","2":"2.343730594","3":"0.49724082","4":"0.3648000","5":"0.4806857","6":"0.5"},{"1":"x1","2":"-0.582356684","3":"0.36480000","4":"0.4972408","5":"0.4806857","6":"0.5"},{"1":"x1","2":"0.323206613","3":"0.46791111","4":"0.4884480","5":"0.4807467","6":"0.5"},{"1":"x2","2":"2.281585046","3":"0.49855475","4":"0.2448980","5":"0.4807988","6":"0.5"},{"1":"x1","2":"-1.796286610","3":"0.00000000","4":"0.4993423","5":"0.4818653","6":"0.5"},{"1":"x2","2":"-1.161742789","3":"0.00000000","4":"0.4993423","5":"0.4818653","6":"0.5"},{"1":"x1","2":"1.486004801","3":"0.49293364","4":"0.4555248","5":"0.4822721","6":"0.5"},{"1":"x1","2":"1.442442554","3":"0.49273175","4":"0.4584889","5":"0.4826301","6":"0.5"},{"1":"x1","2":"0.325768984","3":"0.47195291","4":"0.4894641","5":"0.4828098","6":"0.5"},{"1":"x1","2":"2.432939360","3":"0.49767562","4":"0.3750000","5":"0.4829545","6":"0.5"},{"1":"x2","2":"2.293604575","3":"0.49884183","4":"0.2603550","5":"0.4833402","6":"0.5"},{"1":"x1","2":"0.574290652","3":"0.48000000","4":"0.4866116","5":"0.4836364","6":"0.5"},{"1":"x1","2":"-1.960779713","3":"0.00000000","4":"0.4995217","5":"0.4845361","6":"0.5"},{"1":"x2","2":"-1.241636702","3":"0.00000000","4":"0.4995217","5":"0.4845361","6":"0.5"},{"1":"x2","2":"2.519258089","3":"0.49952173","4":"0.0000000","5":"0.4845361","6":"0.5"},{"1":"x1","2":"0.366954472","3":"0.47562827","4":"0.4904488","5":"0.4847429","6":"0.5"},{"1":"x1","2":"1.436278077","3":"0.49346939","4":"0.4644444","5":"0.4847619","6":"0.5"},{"1":"x1","2":"1.419537021","3":"0.49327872","4":"0.4667014","5":"0.4850397","6":"0.5"},{"1":"x1","2":"2.482942028","3":"0.49806888","4":"0.3856333","5":"0.4851388","6":"0.5"},{"1":"x1","2":"0.571872338","3":"0.48175735","4":"0.4882721","5":"0.4853730","6":"0.5"},{"1":"x1","2":"0.659906227","3":"0.48255042","4":"0.4878377","5":"0.4854320","6":"0.5"},{"1":"x2","2":"2.473922169","3":"0.49932842","4":"0.1975309","5":"0.4857475","6":"0.5"},{"1":"x2","2":"2.421916511","3":"0.49909461","4":"0.2777778","5":"0.4858156","6":"0.5"},{"1":"x1","2":"0.425475683","3":"0.47896121","4":"0.4914002","5":"0.4865490","6":"0.5"},{"1":"x1","2":"0.434501300","3":"0.48000000","4":"0.4911111","5":"0.4866667","6":"0.5"},{"1":"x1","2":"1.432136010","3":"0.49417732","4":"0.4697662","5":"0.4867319","6":"0.5"},{"1":"x1","2":"0.516429077","3":"0.48269335","4":"0.4901508","5":"0.4869441","6":"0.5"},{"1":"x1","2":"1.391351682","3":"0.49400607","4":"0.4716553","5":"0.4869656","6":"0.5"},{"1":"x1","2":"0.566817311","3":"0.48347107","4":"0.4897959","5":"0.4870130","6":"0.5"},{"1":"x1","2":"0.687617592","3":"0.48487713","4":"0.4890261","5":"0.4871176","6":"0.5"},{"1":"x1","2":"0.693435680","3":"0.48551381","4":"0.4886080","5":"0.4871538","6":"0.5"},{"1":"x1","2":"-2.017570738","3":"0.00000000","4":"0.4996713","5":"0.4871795","6":"0.5"},{"1":"x2","2":"-1.314363134","3":"0.00000000","4":"0.4996713","5":"0.4871795","6":"0.5"},{"1":"x2","2":"2.664528311","3":"0.49967127","4":"0.0000000","5":"0.4871795","6":"0.5"},{"1":"x1","2":"2.489806031","3":"0.49842192","4":"0.3966942","5":"0.4872319","6":"0.5"},{"1":"x2","2":"2.433115748","3":"0.49931413","4":"0.2975207","5":"0.4882155","6":"0.5"},{"1":"x1","2":"0.433582885","3":"0.48197404","4":"0.4923161","5":"0.4882310","6":"0.5"},{"1":"x2","2":"2.477865286","3":"0.49951172","4":"0.2187500","5":"0.4882812","6":"0.5"},{"1":"x1","2":"0.437542376","3":"0.48285322","4":"0.4920556","5":"0.4883287","6":"0.5"},{"1":"x1","2":"0.470808790","3":"0.48366962","4":"0.4917817","5":"0.4884152","6":"0.5"},{"1":"x1","2":"0.508118067","3":"0.48442907","4":"0.4914934","5":"0.4884910","6":"0.5"},{"1":"x1","2":"0.528698093","3":"0.48513674","4":"0.4911896","5":"0.4885566","6":"0.5"},{"1":"x1","2":"0.692220033","3":"0.48699272","4":"0.4901738","5":"0.4886946","6":"0.5"},{"1":"x1","2":"0.708542916","3":"0.48753463","4":"0.4897959","5":"0.4887218","6":"0.5"},{"1":"x1","2":"0.768219076","3":"0.48804336","4":"0.4893958","5":"0.4887399","6":"0.5"},{"1":"x1","2":"1.385771564","3":"0.49470156","4":"0.4760742","5":"0.4887408","6":"0.5"},{"1":"x1","2":"1.348700546","3":"0.49454221","4":"0.4775023","5":"0.4889190","6":"0.5"},{"1":"x1","2":"2.490978713","3":"0.49873599","4":"0.4081633","5":"0.4892259","6":"0.5"},{"1":"x1","2":"0.455341779","3":"0.48542534","4":"0.4929618","5":"0.4898718","6":"0.5"},{"1":"x1","2":"0.488746502","3":"0.48611111","4":"0.4927170","5":"0.4899425","6":"0.5"},{"1":"x1","2":"0.752532941","3":"0.48936632","4":"0.4909393","5":"0.4901843","6":"0.5"},{"1":"x1","2":"0.818429991","3":"0.48979592","4":"0.4905805","5":"0.4901961","6":"0.5"},{"1":"x1","2":"0.887558794","3":"0.49058055","4":"0.4897959","5":"0.4901961","6":"0.5"},{"1":"x1","2":"0.878706588","3":"0.49020000","4":"0.4902000","5":"0.4902000","6":"0.5"},{"1":"x1","2":"1.351103591","3":"0.49536351","4":"0.4800000","5":"0.4903704","6":"0.5"},{"1":"x1","2":"1.334410988","3":"0.49522302","4":"0.4811762","5":"0.4905173","6":"0.5"},{"1":"x2","2":"2.453887785","3":"0.49950139","4":"0.3200000","5":"0.4905263","6":"0.5"},{"1":"x2","2":"2.493685703","3":"0.49966442","4":"0.2448980","5":"0.4907476","6":"0.5"},{"1":"x1","2":"1.279559523","3":"0.49476099","4":"0.4841434","5":"0.4908856","6":"0.5"},{"1":"x1","2":"2.499842651","3":"0.49901235","4":"0.4200000","5":"0.4911111","6":"0.5"},{"1":"x1","2":"0.915277236","3":"0.49203506","4":"0.4910192","5":"0.4915424","6":"0.5"},{"1":"x1","2":"0.880230865","3":"0.49171650","4":"0.4913784","5":"0.4915492","6":"0.5"},{"1":"x1","2":"0.840697451","3":"0.49137843","4":"0.4917165","5":"0.4915492","6":"0.5"},{"1":"x1","2":"1.301941035","3":"0.49586777","4":"0.4844291","5":"0.4919786","6":"0.5"},{"1":"x1","2":"1.297167310","3":"0.49573964","4":"0.4853061","5":"0.4920879","6":"0.5"},{"1":"x1","2":"1.282878941","3":"0.49560547","4":"0.4861111","5":"0.4921875","6":"0.5"},{"1":"x1","2":"1.270289602","3":"0.49546485","4":"0.4868517","5":"0.4922780","6":"0.5"},{"1":"x1","2":"0.916822986","3":"0.49334320","4":"0.4921875","5":"0.4927885","6":"0.5"},{"1":"x1","2":"2.526092968","3":"0.49925216","4":"0.4321330","5":"0.4928758","6":"0.5"},{"1":"x1","2":"1.301202425","3":"0.49647456","4":"0.4872926","5":"0.4933068","6":"0.5"},{"1":"x1","2":"1.287421847","3":"0.49636440","4":"0.4879984","5":"0.4933945","6":"0.5"},{"1":"x1","2":"1.269316909","3":"0.49612800","4":"0.4892444","5":"0.4935467","6":"0.5"},{"1":"x1","2":"0.946183859","3":"0.49451247","4":"0.4932964","5":"0.4939348","6":"0.5"},{"1":"x1","2":"2.551446154","3":"0.49945659","4":"0.4444444","5":"0.4945055","6":"0.5"},{"1":"x1","2":"1.244438442","3":"0.49674818","4":"0.4913435","5":"0.4946944","6":"0.5"},{"1":"x1","2":"1.149480708","3":"0.49652778","4":"0.4921875","5":"0.4947917","6":"0.5"},{"1":"x1","2":"0.951265099","3":"0.49555002","4":"0.4943413","5":"0.4949819","6":"0.5"},{"1":"x1","2":"1.238769995","3":"0.49732302","4":"0.4931692","5":"0.4957238","6":"0.5"},{"1":"x1","2":"1.210624499","3":"0.49723380","4":"0.4935107","5":"0.4957632","6":"0.5"},{"1":"x1","2":"1.126644806","3":"0.49714003","4":"0.4938272","5":"0.4957983","6":"0.5"},{"1":"x1","2":"1.084827301","3":"0.49704142","4":"0.4941211","5":"0.4958295","6":"0.5"},{"1":"x1","2":"1.071866057","3":"0.49682826","4":"0.4946492","5":"0.4958804","6":"0.5"},{"1":"x1","2":"1.053188784","3":"0.49671293","4":"0.4948870","5":"0.4959004","6":"0.5"},{"1":"x1","2":"1.040697342","3":"0.49659120","4":"0.4951093","5":"0.4959169","6":"0.5"},{"1":"x1","2":"0.953833479","3":"0.49646257","4":"0.4953174","5":"0.4959301","6":"0.5"},{"1":"x1","2":"2.576843426","3":"0.49962674","4":"0.4567474","5":"0.4959820","6":"0.5"},{"1":"x1","2":"1.224054162","3":"0.49785004","4":"0.4947403","5":"0.4966372","6":"0.5"},{"1":"x1","2":"3.166971551","3":"0.49987919","4":"0.4081633","5":"0.4966691","6":"0.5"},{"1":"x1","2":"1.098734773","3":"0.49770181","4":"0.4952409","5":"0.4966928","6":"0.5"},{"1":"x1","2":"1.079757235","3":"0.49762188","4":"0.4954649","5":"0.4967159","6":"0.5"},{"1":"x1","2":"1.072035946","3":"0.49753770","4":"0.4956733","5":"0.4967360","6":"0.5"},{"1":"x1","2":"1.058348565","3":"0.49744898","4":"0.4958678","5":"0.4967532","6":"0.5"},{"1":"x1","2":"1.047457586","3":"0.49735537","4":"0.4960494","5":"0.4967677","6":"0.5"},{"1":"x1","2":"1.028464289","3":"0.49725652","4":"0.4962193","5":"0.4967794","6":"0.5"},{"1":"x1","2":"2.624577968","3":"0.49976371","4":"0.4687500","5":"0.4972826","6":"0.5"},{"1":"x1","2":"1.076956974","3":"0.49814745","4":"0.4966090","5":"0.4974936","6":"0.5"},{"1":"x1","2":"3.503126460","3":"0.49994686","4":"0.4444444","5":"0.4982818","6":"0.5"},{"1":"x1","2":"2.693936802","3":"0.49986852","4":"0.4800000","5":"0.4983784","6":"0.5"},{"1":"x1","2":"2.988126490","3":"0.49994575","4":"0.4687500","5":"0.4986979","6":"0.5"},{"1":"x1","2":"2.710763558","3":"0.49994219","4":"0.4897959","5":"0.4992320","6":"0.5"},{"1":"x1","2":"3.529264199","3":"0.49998685","4":"0.4800000","5":"0.4994872","6":"0.5"},{"1":"x1","2":"2.929863726","3":"0.49998629","4":"0.4938272","5":"0.4997091","6":"0.5"},{"1":"x1","2":"2.887947028","3":"0.49998600","4":"0.4958678","5":"0.4997595","6":"0.5"},{"1":"x1","2":"2.742092422","3":"0.49998570","4":"0.4970414","5":"0.4997943","6":"0.5"},{"1":"x1","2":"2.813038608","3":"0.50000000","4":"0.5000000","5":"0.5000000","6":"0.5"},{"1":"x1","2":"2.892025340","3":"0.50000000","4":"0.5000000","5":"0.5000000","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We plot for variables <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> the weighted average Gini index for each possible split of data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test , <span class="fu">aes</span>(<span class="at">x=</span>split_rule, <span class="at">y =</span>imp_total, <span class="at">col =</span> feature_split)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is achieved for <span class="math inline">\(x_2\)</span> and a value of <span class="math inline">\(0.15\)</span> which is consistent with the <code>R</code> implementation (the slight difference <span class="math inline">\(0.15\)</span> vs <span class="math inline">\(0.14\)</span>: <code>CART/rpart</code> splits variables at midpoint between successive values in data set, while we split ‘on’ the values):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(node_val <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.1508644","3":"0.1420118","4":"0.4558072","5":"0.3742204","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We then implement the recursive algorithm, specifying some rules to stop (the node is pure, a maximum tree depth is attained, a minimum number of observations per node is attained).</p>
<p>At each step a node/list stores the relevant information: split variable and value, left/right children, impurity, number of observations for class <span class="math inline">\(0/1\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_node,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"impurity"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_zero"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_one"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function implementing the best split and returning the splitting rule:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>break_at <span class="ot">&lt;-</span> <span class="cf">function</span>(node, min_leaf){</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    x_names <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> <span class="fu">max_impurity_decrease</span>(tbl_node, y_name, x_names, gini, min_leaf)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>               imp_total <span class="sc">!=</span> <span class="dv">666</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>               imp_node <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># don't split when node is pure (ie 0 impurity)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(break_node)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function implementing the stopping rule in the recursion (either the max tree depth is attained, or there is a single element in the node):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>conditional_split <span class="ot">&lt;-</span> <span class="cf">function</span>(node, depth, max_depth, min_leaf)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(node[[<span class="st">"data"</span>]]) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> depth <span class="sc">==</span> max_depth) {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]] </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      table_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">!!</span>y_name) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">table</span>()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">#print(table_node)</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      n_zero_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">1</span>])</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"n_zero"</span>]] <span class="ot">&lt;-</span> n_zero_node</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      n_one_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">2</span>])</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"n_one"</span>]] <span class="ot">&lt;-</span> n_one_node</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      prob_node <span class="ot">&lt;-</span> n_one_node <span class="sc">/</span> (n_zero_node<span class="sc">+</span> n_one_node)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">#print(prob_node)</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"p1"</span>]] <span class="ot">&lt;-</span> prob_node</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>      vote_node<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n_one_node<span class="sc">&gt;</span> n_zero_node, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"vote"</span>]] <span class="ot">&lt;-</span> vote_node</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)}</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">grow_decision_tree</span>(node, depth <span class="sc">+</span> <span class="dv">1</span>, max_depth, min_leaf)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>}    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function implementing the recursion and computing metrics for the nodes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grow_decision_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">depth =</span> <span class="dv">1</span>, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">5</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># before split</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  x_names  <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]  </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]  </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  table_node <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">!!</span>y_name) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">table</span>()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(table_node)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  n_zero_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">1</span>])</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"n_zero"</span>]] <span class="ot">&lt;-</span> n_zero_node</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  n_one_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">2</span>])</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"n_one"</span>]] <span class="ot">&lt;-</span> n_one_node</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  prob_node <span class="ot">&lt;-</span> n_one_node <span class="sc">/</span> (n_zero_node<span class="sc">+</span> n_one_node)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(prob_node)</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"p1"</span>]] <span class="ot">&lt;-</span> prob_node</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  vote_node<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n_one_node<span class="sc">&gt;</span> n_zero_node, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"vote"</span>]] <span class="ot">&lt;-</span> vote_node</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split using break node function</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  break_node <span class="ot">&lt;-</span> <span class="fu">break_at</span>(node, min_leaf)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(break_node) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)}</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  x_name_node <span class="ot">&lt;-</span> <span class="fu">as.name</span>(break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(feature_split))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  split_value_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(split_rule)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"impurity"</span>]] <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_node)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"split"</span>]] <span class="ot">&lt;-</span> split_value_node</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"feature_split"</span>]] <span class="ot">&lt;-</span> x_name_node</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recursion, calling conditional split for left/right children</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&lt;</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_left,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">666</span>)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span> <span class="fu">conditional_split</span>(node_left, depth, max_depth, min_leaf)</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&gt;=</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_right,</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">666</span>)</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span> <span class="fu">conditional_split</span>(node_right, depth, max_depth, min_leaf)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"left"</span>]] <span class="ot">&lt;-</span> node_left</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"right"</span>]] <span class="ot">&lt;-</span> node_right</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(node)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="co"># inspired from</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/61621974/r-recursive-tree-algorithm-with-a-random-split</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="co"># mydata &lt;- data.frame(x = c(10, 20, 25, 35), y = c(-10.5, 6.5, 7.5, -7.5))</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="co"># conditional_split &lt;- function(df, depth, max_depth)</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="co"># {</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   if(nrow(df) == 1 | depth == max_depth) return(df)</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   else grow_tree(df, depth + 1, max_depth)</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="co"># grow_tree &lt;- function(df, depth = 1, max_depth = 3)</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a><span class="co"># {</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   break_at &lt;- sample(nrow(df) - 1, 1)</span></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   branched &lt;- list(left = df[1:break_at,], right = df[-seq(break_at),])</span></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(branched, conditional_split, depth, max_depth)</span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a><span class="co"># tree &lt;- grow_tree(mydata, max_depth = 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also define a function to visualize the tree and branches:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>print_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(grown_tree, <span class="at">shift =</span><span class="st">''</span>){</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Node</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (grown_tree<span class="sc">$</span>is_leaf <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        p1 <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>p1,<span class="dv">2</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        class <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>vote</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        n_zero <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>n_zero</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        n_one <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>n_one</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'prob 1: {p1}, class: {class}, 0-1: {n_zero}/{n_one}'</span>))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Else recurse</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First print the splitting variable and rule</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(shift <span class="sc">==</span> <span class="st">''</span>){</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">'Root'</span> , <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>split</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        feature_split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>feature_split</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(glue::glue('Node {feature_split} &lt; {split} Y/N?'))</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &lt; {split}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_tree</span>(grown_tree<span class="sc">$</span>left, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &gt;= {split}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_tree</span>(grown_tree<span class="sc">$</span>right, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We test the recursive algorithm on the mixture data set, specifying parameters similar to <code>rpart</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mixture_node <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree</span>(node, <span class="at">max_depth =</span> <span class="dv">4</span>, <span class="at">min_leaf =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.01</span>,<span class="dv">0</span>), <span class="cf">function</span>(x){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  X_rpart <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> .,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"class"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_mixture_example,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> x, <span class="at">minbucket =</span> <span class="dv">7</span>, <span class="at">maxdepth =</span> <span class="dv">4</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(l)) {</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(l[[i]])</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mixture_example_CART <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="fl">0.0001</span>, <span class="at">minbucket =</span> <span class="dv">7</span>, <span class="at">maxdepth =</span> <span class="dv">4</span>), <span class="at">method =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We compare our implementation with <code>rpart</code> which are equivalent (slight difference, even if a split is admissible for terminal nodes improving the impurity, <code>rpart</code> does not split if it results in two terminal nodes predicting the same class):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_tree</span>((mixture_node))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; x2 &lt; 0.150864352557061 
     |&gt; x2 &lt; -0.33073523181521 
       prob 1: 0, class: 0, 0-1: 31/0 
     |&gt; x2 &gt;= -0.33073523181521 
       |&gt; x2 &lt; -0.109150386642537 
         prob 1: 0.43, class: 0, 0-1: 4/3 
       |&gt; x2 &gt;= -0.109150386642537 
         |&gt; x1 &lt; 1.0406973415597 
           prob 1: 0, class: 0, 0-1: 7/0 
         |&gt; x1 &gt;= 1.0406973415597 
           prob 1: 0.14, class: 0, 0-1: 6/1 
 
 
 
   |&gt; x2 &gt;= 0.150864352557061 
     |&gt; x1 &lt; 2.26271414773515 
       |&gt; x2 &lt; 0.979110495305305 
         |&gt; x1 &lt; 1.07975723459102 
           prob 1: 0.24, class: 0, 0-1: 22/7 
         |&gt; x1 &gt;= 1.07975723459102 
           prob 1: 0.95, class: 1, 0-1: 1/20 
 
       |&gt; x2 &gt;= 0.979110495305305 
         |&gt; x1 &lt; -0.912620058512936 
           prob 1: 1, class: 1, 0-1: 0/15 
         |&gt; x1 &gt;= -0.912620058512936 
           prob 1: 0.78, class: 1, 0-1: 14/49 
 
 
     |&gt; x1 &gt;= 2.26271414773515 
       |&gt; x1 &lt; 3.16697155071072 
         prob 1: 0, class: 0, 0-1: 13/0 
       |&gt; x1 &gt;= 3.16697155071072 
         prob 1: 0.71, class: 1, 0-1: 2/5 
 
 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"-------------------"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-------------------"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 200 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 200 100 0 (0.50000000 0.50000000)  
   2) x2&lt; 0.1441271 52   4 0 (0.92307692 0.07692308) *
   3) x2&gt;=0.1441271 148  52 1 (0.35135135 0.64864865)  
     6) x1&gt;=2.245715 20   5 0 (0.75000000 0.25000000) *
     7) x1&lt; 2.245715 128  37 1 (0.28906250 0.71093750)  
      14) x2&lt; 0.976433 50  23 1 (0.46000000 0.54000000)  
        28) x1&lt; 1.016795 29   7 0 (0.75862069 0.24137931) *
        29) x1&gt;=1.016795 21   1 1 (0.04761905 0.95238095) *
      15) x2&gt;=0.976433 78  14 1 (0.17948718 0.82051282) *</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = Y ~ ., data = data_mixture_example, method = "class", 
    control = rpart.control(cp = 1e-04, minbucket = 7, maxdepth = 4))

Variables actually used in tree construction:
[1] x1 x2

Root node error: 100/200 = 0.5

n= 200 

      CP nsplit rel error xerror     xstd
1 0.4400      0      1.00   1.16 0.069800
2 0.1000      1      0.56   0.58 0.064172
3 0.0750      2      0.46   0.61 0.065111
4 0.0001      4      0.31   0.43 0.058099</code></pre>
</div>
</div>
<p>We do the same job with the <code>Iris</code> data set which is a multivariate data set used and made famous by the British statistician and biologist Ronald Fisher in his 1936 paper about linear discriminant analysis, we restrict to a binary classification problem excluding the <code>setosa</code> family:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>tbl_iris <span class="ot">=</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Species<span class="sc">!=</span><span class="st">'setosa'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="dv">0</span>), <span class="cf">function</span>(x){</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  X_rpart <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    Species <span class="sc">~</span> .,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"class"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tbl_iris,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> x, <span class="at">minbucket =</span> <span class="dv">5</span>, <span class="at">maxdepth =</span> <span class="dv">4</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(l)) {</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(l[[i]])</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_iris,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"impurity"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"target"</span> <span class="ot">=</span> <span class="fu">as.name</span>(<span class="st">"Species"</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"features"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"Sepal.Length"</span>), <span class="fu">as.name</span>(<span class="st">"Sepal.Width"</span>), <span class="fu">as.name</span>(<span class="st">"Petal.Length"</span>), <span class="fu">as.name</span>(<span class="st">"Petal.Width"</span>)),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_zero"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_one"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>iris_node <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree</span>(node, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.01</span>), <span class="cf">function</span>(x){</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  X_rpart <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    Species <span class="sc">~</span> .,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"class"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tbl_iris,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">7</span>,<span class="at">cp=</span>x)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(l)) {</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(l[[i]])</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-33-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_tree</span>((iris_node))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; Petal.Width &lt; 1.8 
     |&gt; Petal.Length &lt; 5 
       prob 1: 0.02, class: 0, 0-1: 47/1 
     |&gt; Petal.Length &gt;= 5 
       prob 1: 0.67, class: 1, 0-1: 2/4 
 
   |&gt; Petal.Width &gt;= 1.8 
     |&gt; Petal.Length &lt; 5 
       prob 1: 0.83, class: 1, 0-1: 1/5 
     |&gt; Petal.Length &gt;= 5 
       prob 1: 1, class: 1, 0-1: 0/40 
 </code></pre>
</div>
</div>
</section>
<section id="building-strategy---pruning" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="building-strategy---pruning"><span class="header-section-number">1.3</span> Building strategy - Pruning</h2>
<p>The tree-building process described just above is likely to produce good predictions on the training set, but is also likely to overfit the data, leading to poor predictions on testing set or new data. This is because the resulting tree might be too complex. In an extreme case, if we do not restrict the tree depth and allow a low minimum number of observations per leaf, many observations could be alone in their own region/node. Conversely, a smaller tree with fewer splits/nodes/regions might underfit, missing key patterns in the data. The right balance leading to lower variance and better interpretation at the cost of a little bias.</p>
<p>We can see the number of nodes or tree size as a parameter allowing to tune the model complexity. We have to select this parameter.</p>
<p>The CART algorithm mainly uses the number of terminal nodes. The tree depth can also be used.</p>
<p>The CART strategy is to build a large tree <span class="math inline">\(T_0\)</span> and then sequentially prune it to obtain a sequence of nested trees.</p>
<p>Then a Cost complexity criterion is defined as:</p>
<p><span class="math display">\[
C_\alpha(T)=\hat R(T)+\alpha|T|
\]</span> where <span class="math inline">\(\hat R(T)\)</span> denote the empirical risk or a similar metric, <span class="math inline">\(|T|\)</span> the number of terminal nodes in <span class="math inline">\(T\)</span> and <span class="math inline">\(\alpha\)</span> is a parameter.</p>
<p>The idea is for a sequence of <span class="math inline">\(\alpha\)</span>, find the subtree <span class="math inline">\(T_\alpha \subset T_0\)</span> minimizing <span class="math inline">\(C_\alpha(T)\)</span>.</p>
<p>Then cross-validation is chosen to find and ‘optimal’ value of <span class="math inline">\(\alpha\)</span>.</p>
</section>
<section id="exercise" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="exercise"><span class="header-section-number">1.4</span> Exercise</h2>
<p>Using the Desbois data set, build and draw a decision tree using <code>rpart</code>.</p>
<p>Compare a large tree and a smaller tree in terms of ROC/AUC/prediction on a testing set.</p>
<p>Try to understand the output of the <code>printcp</code> function.</p>
<p>Choose a terminal number of leafs and prune the tree using the <code>prune</code> function.</p>
<p>Select the optimal <code>cp</code> for your tree (you can use a plot) and compare to the large and small models in terms of AUC.</p>
</section>
</section>
<section id="ensemble-methods" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Ensemble methods</h1>
<section id="adaboost" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="adaboost"><span class="header-section-number">2.1</span> Adaboost</h2>
</section>
<section id="random-forest" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">2.2</span> Random Forest</h2>
</section>
<section id="gradient-boosting" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="gradient-boosting"><span class="header-section-number">2.3</span> Gradient Boosting</h2>
</section>
<section id="appendix" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="appendix"><span class="header-section-number">2.4</span> Appendix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gini_show  <span class="ot">&lt;-</span> <span class="cf">function</span>(tree){</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate gini index for `rpart` tree</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  ylevels <span class="ot">&lt;-</span> <span class="fu">attributes</span>(tree)[[<span class="st">"ylevels"</span>]]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  nclass <span class="ot">&lt;-</span> <span class="fu">length</span>(ylevels)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  yval2 <span class="ot">&lt;-</span> tree[[<span class="st">"frame"</span>]][[<span class="st">"yval2"</span>]]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> tree[[<span class="st">"frame"</span>]][[<span class="st">"var"</span>]]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  labls <span class="ot">=</span> <span class="fu">labels</span>(tree)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">length</span>(labls), <span class="at">ncol=</span><span class="dv">5</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Name"</span>, <span class="st">"GiniIndex"</span>, <span class="st">"Class"</span>, <span class="st">"Items"</span>, <span class="st">"ItemProbs"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars)){</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> yval2[i , ]</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    node.class <span class="ot">&lt;-</span> row[<span class="dv">1</span>]</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    node.class_counts <span class="ot">=</span> row[j<span class="sc">:</span>(j<span class="sc">+</span>nclass<span class="dv">-1</span>)]</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    j <span class="ot">&lt;-</span> j<span class="sc">+</span>nclass</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    node.class_probs <span class="ot">=</span> row[j<span class="sc">:</span>(j<span class="sc">+</span>nclass<span class="dv">-1</span>)]</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    gini <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">sum</span>(node.class_probs<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    gini <span class="ot">=</span> <span class="fu">round</span>(gini,<span class="dv">5</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    name <span class="ot">=</span> <span class="fu">paste</span>(vars[i], <span class="st">" ("</span>, labls[i], <span class="st">")"</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    df[i,] <span class="ot">=</span> <span class="fu">c</span>(name, gini, node.class, <span class="fu">toString</span>(<span class="fu">round</span>(node.class_counts,<span class="dv">5</span>)), <span class="fu">toString</span>(<span class="fu">round</span>(node.class_probs,<span class="dv">5</span>)))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">gini_show</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["GiniIndex"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Class"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Items"],"name":[4],"type":["chr"],"align":["left"]},{"label":["ItemProbs"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"x2  ( root )","2":"0.5","3":"1","4":"100, 100","5":"0.5, 0.5"},{"1":"<leaf>  ( x2< 0.1441 )","2":"0.14201","3":"1","4":"48, 4","5":"0.92308, 0.07692"},{"1":"x1  ( x2>=0.1441 )","2":"0.45581","3":"2","4":"52, 96","5":"0.35135, 0.64865"},{"1":"<leaf>  ( x1>=2.246 )","2":"0.375","3":"1","4":"15, 5","5":"0.75, 0.25"},{"1":"x2  ( x1< 2.246 )","2":"0.41101","3":"2","4":"37, 91","5":"0.28906, 0.71094"},{"1":"x1  ( x2< 0.9764 )","2":"0.4968","3":"2","4":"23, 27","5":"0.46, 0.54"},{"1":"<leaf>  ( x1< 1.017 )","2":"0.36623","3":"1","4":"22, 7","5":"0.75862, 0.24138"},{"1":"<leaf>  ( x1>=1.017 )","2":"0.0907","3":"2","4":"1, 20","5":"0.04762, 0.95238"},{"1":"<leaf>  ( x2>=0.9764 )","2":"0.29454","3":"2","4":"14, 64","5":"0.17949, 0.82051"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Problems (see Geron p249 Figure 6-7. Sensitivity to training set rotation)</p>
<!--  in the original CART 5.2.2  --- -->
<!-- In some data, the classes are naturally separated by hyperplanes not perpendicular to the coordinate axes. These problems are difficult for the unmodified tree structured procedure and result in large trees as the algorithm attempts to approximate the hyperplanes by multidimensional rectangular regions. To cope with such situations, the basic structure has been enhanced to allow a search for best splits over linear combinations of variables.--- -->
<!--  4.6 The use of Gini impurity measure is justified --- -->
<!--  https://stats.stackexchange.com/questions/4356/does-rpart-use-multivariate-splits-by-default --- -->
</section>
</section>
<section id="references" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Breiman83" class="csl-entry" role="listitem">
Breiman, L., J. H. Friedman, R. A. Olshen, and C. J and Stone. 1983. <em>Classification and Regression Trees</em>. Belmont, Ca: Wadsworth.
</div>
<div id="ref-hastie2009" class="csl-entry" role="listitem">
Hastie, T., R. Tibshirani, and J. Friedman. 2009. <em>The Elements of Statistical Learning</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>.
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There are ways to cope with non-linearities using Logistic Regression model. We have briefly seen in the first course that one can modify input variables with splines or with binning. Sections 5.6 <code>Nonparametric Logistic Regression</code> and 9.1 <code>Generalized Additive Models</code> of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> present methods to move beyond linearity in the context of Logistic Regression.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>